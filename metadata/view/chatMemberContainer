{
    "type": "Ext.Container",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "container|align": "stretchmax",
        "designer|userAlias": "chatmembercontainer",
        "designer|userClassName": "chatMemberContainer",
        "height": 50,
        "itemId": "chatMemberContainer",
        "layout": "hbox",
        "padding": "4px"
    },
    "designerId": "83985046-0e5e-4d1a-a300-f8d4d598009b",
    "cn": [
        {
            "type": "Ext.Img",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "height": null,
                "itemId": "chatUserImage",
                "style": [
                    "{\r",
                    "    'border-radius': '50% 50% 50% 50%',\r",
                    "    'margin-right': '5px',\r",
                    "    'background-position': 'center center',\r",
                    "    width: '45px',\r",
                    "    height: '45px',\r",
                    "    'border-radius': '999px',\r",
                    "    '-moz-border-radius': '999px'\r",
                    "}"
                ],
                "width": 45
            },
            "configAlternates": {
                "style": "object"
            },
            "designerId": "669914ef-8052-4f99-89ff-934a930f12fd"
        },
        {
            "type": "Ext.Component",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "itemId": "chatUserName"
            },
            "designerId": "d7bab21f-416c-44a8-b5d4-d19174db9fe6"
        },
        {
            "type": "Ext.Spacer",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "designerId": "8ad6fe15-093b-4fd1-9027-bb54f5e31d80"
        },
        {
            "type": "Ext.Button",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|uiInterfaceName": "confirm",
                "hidden": true,
                "iconCls": "newPerson",
                "itemId": "newUserButton",
                "locales": [
                    "{\"text\":\"labels.addChatUser\"}"
                ],
                "text": null,
                "ui": "confirm",
                "width": "100%"
            },
            "configAlternates": {
                "local": "array",
                "locales": "array"
            },
            "designerId": "ad3550b7-522f-42ba-b129-8d9d8656ec11",
            "customConfigs": [
                {
                    "group": "(Custom Properties)",
                    "name": "local",
                    "type": "string"
                },
                {
                    "group": "(Custom Properties)",
                    "name": "locales",
                    "type": "string"
                }
            ],
            "cn": [
                {
                    "type": "basiceventbinding",
                    "reference": {
                        "name": "listeners",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fn": "onNewUserButtonTap",
                        "implHandler": [
                            "var dataController=VKM.app.getController('InitDataLoader');\r",
                            "var controller=this;\r",
                            "var chatId=button.chatId;\r",
                            "var membersSet=button.membersSet;\r",
                            "var admin_id=button.adminId;\r",
                            "var users=button.users;\r",
                            "var member=button.member;\r",
                            "\r",
                            "if(controller.contactChooser)\r",
                            "{\r",
                            "    controller.contactChooser.destroy();\r",
                            "}\r",
                            "controller.contactChooser=Ext.Viewport.add({\r",
                            "    itemId:'tmpPanel',\r",
                            "    xtype: 'popupchooser',\r",
                            "    items:[\r",
                            "        {\r",
                            "            xtype: 'container',\r",
                            "            itemId: 'contactsNewChat',\r",
                            "            layout: {\r",
                            "                type: 'fit'\r",
                            "            },\r",
                            "            items: [\r",
                            "                {\r",
                            "                    xtype:\"container\",\r",
                            "                    docked:\"top\",\r",
                            "                    layout:\"hbox\",\r",
                            "                    items:[\r",
                            "                        {\r",
                            "                            xtype: 'searchfield',\r",
                            "                            boundStore: 'Friends',\r",
                            "                            doFilter: 'true',\r",
                            "                            fields: [\r",
                            "                                'first_name',\r",
                            "                                'last_name'\r",
                            "                            ],\r",
                            "                            flex:1,\r",
                            "\r",
                            "                            itemId: 'searchAllContacts',\r",
                            "                            listeners: [\r",
                            "                                {\r",
                            "                                    fn: function(element, eOpts) {\r",
                            "                                        this.setPlaceHolder(ux.locale.Manager.get('labels.Search'));\r",
                            "                                    },\r",
                            "                                    event: 'painted'\r",
                            "                                }\r",
                            "                            ]\r",
                            "                        },\r",
                            "\r",
                            "                        {\r",
                            "                            xtype:'button',\r",
                            "                            itemId:\"closeButton\",\r",
                            "                            ui:\"decline\",\r",
                            "                            iconCls:'delete',\r",
                            "                            handler:VKM.app.closeTmpPanels,\r",
                            "//                             style:{\r",
                            "//                                 position:\"absolute\",\r",
                            "//                                 top:2,\r",
                            "//                                 left:2,\r",
                            "//                                 zIndex:99999\r",
                            "//                             }\r",
                            "                        }\r",
                            "                    ]\r",
                            "                },\r",
                            "                {\r",
                            "                    xtype: 'list',\r",
                            "                    itemId: 'contactsToSendList',\r",
                            "                    defaultType: 'contactItem',\r",
                            "                    mode:'SINGLE',\r",
                            "                    store: 'Friends',\r",
                            "                    grouped: true,\r",
                            "\r",
                            "                    useSimpleItems: false,\r",
                            "                    memberc:member,\r",
                            "                    indexBar: {\r",
                            "                        itemId: 'friendsIndex',\r",
                            "                        style: {\r",
                            "                            'font-size': '1.2em'\r",
                            "                        }\r",
                            "                    },\r",
                            "\r",
                            "                    plugins: [\r",
                            "                        {\r",
                            "                            autoPaging: true,\r",
                            "                            loadMoreText: ' ',\r",
                            "                            noMoreRecordsText: ' ',\r",
                            "                            type: 'listpaging'\r",
                            "                        },\r",
                            "                        {\r",
                            "                            type: 'pullrefresh'\r",
                            "                        }\r",
                            "                    ],\r",
                            "                    listeners:[\r",
                            "                         {\r",
                            "                            fn: function(element, eOpts) {\r",
                            "                                var store=Ext.getStore('Friends');\r",
                            "                                if(store.getCount()==0)\r",
                            "                                {\r",
                            "                                    var controller=VKM.app.getController('InitDataLoader');\r",
                            "                                    var dataController=VKM.app.getController('DataLoader');\r",
                            "                                    var url='https://api.vk.com/method/execute.friends';\r",
                            "\r",
                            "                                    var params=\r",
                            "                                        {\r",
                            "                                            v:'5.3',\r",
                            "                                            access_token:VKM.app.globals.authData['access_token'],\r",
                            "                                            rev:0\r",
                            "                                        };\r",
                            "\r",
                            "\r",
                            "                                    store.getProxy().setUrl(url);\r",
                            "                                    store.getProxy().setExtraParams(params);\r",
                            "                                    store.getProxy().setReader(\r",
                            "                                        Ext.create(\"ux.Friends\",\r",
                            "                                                   {\r",
                            "                                                       rootProperty: 'response.friends.items',\r",
                            "                                                       totalProperty: 'response.friends.count'\r",
                            "                                                   }\r",
                            "                                                  )\r",
                            "                                    )\r",
                            "                                    store.load({callback:function(request,success,response){\r",
                            "                                        VKM.app.globals.needRefresh['allFriendsList']=false;\r",
                            "                                    }});\r",
                            "\r",
                            "                                }\r",
                            "                            },\r",
                            "                            event: 'painted'\r",
                            "                        },{\r",
                            "                        fn: function(dataView,index,target,record){\r",
                            "\r",
                            "                            var isExists=false;\r",
                            "                            var member=dataView.config.memberc;\r",
                            "                            for (var i=0;i<users.length;i++)\r",
                            "                            {\r",
                            "                                if(users[i]==record.get('id'))\r",
                            "                                {\r",
                            "                                    isExists=true;\r",
                            "                                }\r",
                            "                            };\r",
                            "                            if(!isExists)\r",
                            "                            {\r",
                            "                                member.setHidden(true);\r",
                            "                                users.push(record.get('id'));\r",
                            "                                var memberRecord=Ext.getStore('Users').getById(record.get('id'));\r",
                            "                                if(!memberRecord)\r",
                            "                                {\r",
                            "                                    memberRecord=record\r",
                            "                                }\r",
                            "\r",
                            "                                var member=membersSet.insert(1,{xtype:'chatmembercontainer'});\r",
                            "\r",
                            "                                if(VKM.app.globals.authData['user_id']==admin_id)\r",
                            "                                {\r",
                            "                                    member.down('#deleteFromChatButton').setHidden(false);\r",
                            "                                }\r",
                            "                                member.down('#deleteFromChatButton').deleteData={\r",
                            "                                    chat_id:chatId,\r",
                            "                                    user_id:record.get('id'),\r",
                            "                                    membersSet:membersSet,\r",
                            "                                    member:member\r",
                            "                                }\r",
                            "\r",
                            "\r",
                            "\r",
                            "                                member.down('#chatUserImage').setSrc(memberRecord.get('photo_50'));\r",
                            "                                member.down('#chatUserName').setHtml(memberRecord.get('first_name')+' '+memberRecord.get('last_name'));\r",
                            "\r",
                            "\r",
                            "\r",
                            "\r",
                            "                                var dataController=VKM.app.getController('DataLoader');\r",
                            "                                var url='https://api.vk.com/method/messages.addChatUser';\r",
                            "                                var params=\r",
                            "                                    {\r",
                            "                                        v:'5.4',\r",
                            "                                        chat_id:chatId,\r",
                            "                                        user_id:record.get('id'),\r",
                            "                                        access_token:VKM.app.globals.authData['access_token']\r",
                            "                                    };\r",
                            "                                dataController.go(url,params);\r",
                            "\r",
                            "\r",
                            "                                var newMember=membersSet.add({xtype:'chatmembercontainer'});\r",
                            "                                newMember.down('#chatUserImage').setHidden(true);\r",
                            "                                newMember.down('#chatUserName').setHidden(true);\r",
                            "                                newMember.down('#deleteFromChatButton').setHidden(true);\r",
                            "                                newMember.down('#newUserButton').setHidden(false);\r",
                            "                                newMember.down('#newUserButton').setText(ux.locale.Manager.get('labels.addChatUser'));\r",
                            "                                newMember.down('#newUserButton').chatId=chatId;\r",
                            "                                newMember.down('#newUserButton').membersSet=membersSet;\r",
                            "                                newMember.down('#newUserButton').member=newMember;\r",
                            "                                newMember.down('#newUserButton').adminId=admin_id;\r",
                            "                                newMember.down('#newUserButton').users=users;\r",
                            "\r",
                            "\r",
                            "                            };\r",
                            "                            controller.contactChooser.destroy();\r",
                            "                        },\r",
                            "                        event:'itemtap'\r",
                            "                    }]\r",
                            "                }\r",
                            "            ]\r",
                            "        }\r",
                            "    ]\r",
                            "});"
                        ],
                        "name": "tap"
                    },
                    "designerId": "52d99cf5-3de1-4feb-94bc-06f4c9c32929"
                }
            ]
        },
        {
            "type": "Ext.Button",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|uiInterfaceName": "decline",
                "iconCls": "delete",
                "itemId": "deleteFromChatButton",
                "text": null,
                "ui": "decline"
            },
            "designerId": "a3d991fa-578b-49c6-9820-9be4f43d3246",
            "cn": [
                {
                    "type": "fixedfunction",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|params": [
                            "button",
                            "e"
                        ],
                        "fn": "handler",
                        "implHandler": [
                            "var dataController=VKM.app.getController('DataLoader');\r",
                            "var url='https://api.vk.com/method/messages.removeChatUser';\r",
                            "var params=\r",
                            "    {\r",
                            "        v:'5.4',\r",
                            "        user_id:button.deleteData.user_id,\r",
                            "        chat_id:button.deleteData.chat_id,\r",
                            "        access_token:VKM.app.globals.authData['access_token']\r",
                            "\r",
                            "    };\r",
                            "\r",
                            "button.deleteData.member.setHidden(true);\r",
                            "//button.deleteData.membersSet.remove(button.deleteData.member);\r",
                            "dataController.go(url,params);"
                        ]
                    },
                    "designerId": "72bd1ccf-fa1c-4186-8bf7-7067143218b8"
                }
            ]
        }
    ]
}