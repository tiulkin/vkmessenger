{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "DataLoader"
    },
    "designerId": "8a94ebd4-dd20-4b33-ad90-1cae95092bc1",
    "cn": [
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "url",
                    "params",
                    "callback",
                    "extraData",
                    "method"
                ],
                "fn": "go",
                "implHandler": [
                    "var dataController=VKM.app.getController('DataLoader');\r",
                    "if(!method)\r",
                    "{\r",
                    "    method='GET';\r",
                    "};\r",
                    "if(!callback)\r",
                    "{\r",
                    "    callback=Ext.emptyFn;\r",
                    "}\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "    url: url,\r",
                    "    params:params,\r",
                    "    method: method,\r",
                    "    disableCaching: true,\r",
                    "    extraData:extraData,\r",
                    "    callback: function(request, success,response,extraData) {\r",
                    "        //console.log(response);\r",
                    "        if (success)\r",
                    "        {\r",
                    "            if(response)\r",
                    "            var JsonResponse=JSON.parse(response.responseText);\r",
                    "            if (!JsonResponse.error)\r",
                    "            {\r",
                    "//                 console.log(response);\r",
                    "//                 console.log(JsonResponse);\r",
                    "                callback(response,JsonResponse);\r",
                    "            }\r",
                    "            else\r",
                    "            {\r",
                    "                console.log(response);\r",
                    "                console.log(JsonResponse);\r",
                    "                if (JsonResponse.error.error_code==6||VKM.app.globals.doNotReconnect)\r",
                    "                {\r",
                    "                    var extraData1=response.request.options.extraData;\r",
                    "                    var callback1=callback;\r",
                    "                    var params1=response.request.options.params;\r",
                    "                    var url1=response.request.options.url;\r",
                    "                    var method1=response.request.options.method;\r",
                    "                    setTimeout(dataController.go(url1,params1,callback1,extraData1,method1),1500);\r",
                    "                }\r",
                    "                else\r",
                    "                {\r",
                    "                    if (JsonResponse.error.error_code==5)\r",
                    "                    {\r",
                    "                        var extraData1=response.request.options.extraData;\r",
                    "                        var callback1=callback;\r",
                    "                        var params1=response.request.options.params;\r",
                    "                        var url1=response.request.options.url;\r",
                    "                        var method1=response.request.options.method;\r",
                    "                        VKM.app.getController('Login').relogin(url1,params1,callback1,extraData1);\r",
                    "                    }\r",
                    "                    else\r",
                    "\r",
                    "                    {\r",
                    "                        alert(JsonResponse.error.error_msg)\r",
                    "                    }\r",
                    "                }\r",
                    "            }\r",
                    "        }\r",
                    "        else\r",
                    "\r",
                    "        {\r",
                    "            alert(response.responseText)\r",
                    "        }\r",
                    "    }\r",
                    "})"
                ]
            },
            "designerId": "d93f532d-9140-4713-89a9-bff3aac018f3"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadProfileStep2",
                "implHandler": [
                    "var formData = new FormData();\r",
                    "var dataController=VKM.app.getController('DataLoader');\r",
                    "formData.append(\"photo\", document.getElementById(\"photoToUpload1\").files[0]);\r",
                    "if(users.response&&users.response.upload_url)\r",
                    "{\r",
                    "    var client = new XMLHttpRequest();\r",
                    "    client.onreadystatechange = function ()\r",
                    "    {\r",
                    "        if (client.readyState == 4 && client.status == 200)\r",
                    "        {\r",
                    "            alert(client.response);\r",
                    "        }\r",
                    "    }\r",
                    "    //client.open(\"POST\",users.response.upload_url, true);\r",
                    "    var progressIndicator = Ext.create(\"Ext.ProgressIndicator\", {\r",
                    "        loadingText: \"Uploading: {percent}%\"\r",
                    "    });\r",
                    "\r",
                    "    //            client.send(formData);\r",
                    "    //            /* Send to server */\r",
                    "    Ext.Ajax.request({\r",
                    "        url:users.response.upload_url,\r",
                    "        method: 'POST',\r",
                    "        enctype:'multipart/form-data',\r",
                    "        data:formData,\r",
                    "        progress: progressIndicator,\r",
                    "        //isUpload:true,\r",
                    "        // binaryData:formData,\r",
                    "        xhr2:true,\r",
                    "        callback:function(request,success,response)\r",
                    "        {\r",
                    "\r",
                    "            var controller=VKM.app.getController('Contacts');\r",
                    "            var dataController=VKM.app.getController('DataLoader');\r",
                    "            var data=JSON.parse(response.responseText);\r",
                    "            controller.uploadOverlay.destroy();\r",
                    "\r",
                    "\r",
                    "            var url='https://api.vk.com/method/photos.saveProfilePhoto'; //photos.saveProfilePhoto';\r",
                    "            var params=\r",
                    "                {\r",
                    "                    v:'5.4',\r",
                    "                    access_token:VKM.app.globals.authData['access_token'],\r",
                    "                    server:data.server,\r",
                    "                    photo:data.photo,\r",
                    "                    hash:data.hash\r",
                    "                };\r",
                    "            dataController.go(url,params,dataController.uploadProfileStep3);\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "    })\r",
                    "\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "c9432ddf-9c36-472a-b75c-b9ff8f3f0da2"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "chatHeader",
                "selector": "container#chatHeader"
            },
            "designerId": "4990def7-095f-49ea-bf87-fbd708fdfa12"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadChatStep2",
                "implHandler": [
                    "var formData = new FormData();\r",
                    "var dataController=VKM.app.getController('DataLoader');\r",
                    "formData.append(\"file\", document.getElementById(\"photoToUpload10\").files[0]);\r",
                    "if(users.response&&users.response.upload_url)\r",
                    "{\r",
                    "    var client = new XMLHttpRequest();\r",
                    "    client.onreadystatechange = function ()\r",
                    "    {\r",
                    "        if (client.readyState == 4 && client.status == 200)\r",
                    "        {\r",
                    "            alert(client.response);\r",
                    "        }\r",
                    "    }\r",
                    "    //client.open(\"POST\",users.response.upload_url, true);\r",
                    "    var progressIndicator = Ext.create(\"Ext.ProgressIndicator\", {\r",
                    "        loadingText: \"Uploading: {percent}%\"\r",
                    "    });\r",
                    "\r",
                    "    //            client.send(formData);\r",
                    "    //            /* Send to server */\r",
                    "    Ext.Ajax.request({\r",
                    "        url:users.response.upload_url,\r",
                    "        method: 'POST',\r",
                    "        enctype:'multipart/form-data',\r",
                    "        data:formData,\r",
                    "        progress: progressIndicator,\r",
                    "        //isUpload:true,\r",
                    "        // binaryData:formData,\r",
                    "        xhr2:true,\r",
                    "        callback:function(request,success,response)\r",
                    "        {\r",
                    "\r",
                    "            if(success)\r",
                    "            {\r",
                    "                var controller=VKM.app.getController('Utils');\r",
                    "                var dataController=VKM.app.getController('DataLoader');\r",
                    "                var data=JSON.parse(response.responseText);\r",
                    "                controller.uploadOverlay.destroy();\r",
                    "                //console.log(data);\r",
                    "                \r",
                    "                var url='https://api.vk.com/method/messages.setChatPhoto'; //photos.saveProfilePhoto';\r",
                    "                var params=\r",
                    "                    {\r",
                    "                        v:'5.4',\r",
                    "                        access_token:VKM.app.globals.authData['access_token'],\r",
                    "                        file:data\r",
                    "                    };\r",
                    "                dataController.go(url,params,dataController.uploadChatStep3);\r",
                    "            }\r",
                    "            else\r",
                    "            {\r",
                    "                alert(response.responseText)\r",
                    "            }\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "    })\r",
                    "\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "c5a490f5-ac76-4e86-b537-31962b8291aa"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadProfileStep3",
                "implHandler": [
                    "\r",
                    "if(users.response)\r",
                    "\r",
                    "{\r",
                    "    console.log(users.response);\r",
                    "\r",
                    "    //     if (!VKM.app.globals.me)\r",
                    "//     {\r",
                    "\r",
                    "    var user=Ext.getStore('Users').getById(VKM.app.globals.authData.user_id);\r",
                    "    user.set('photo_50',users.response.photo_src_small);\r",
                    "    user.set('photo_200',users.response.photo_src);\r",
                    "    user.set('photo_100',users.response.photo_src);\r",
                    "    Ext.ComponentQuery.query('#ownerUserPhoto')[0].setHtml('<img src=\"'+users.response.photo_src+'\"\" ></img>')\r",
                    "\r",
                    "    var controller=VKM.app.getController('InitDataLoader');\r",
                    "    controller.loadUnreadMessagesStep1(false,true);\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "9f66fb99-4c3f-4e56-89f5-4f4934fb70d2"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadChatStep3",
                "implHandler": [
                    "console.log(users.response);\r",
                    "if(users.response)\r",
                    "\r",
                    "{\r",
                    "    \r",
                    "\r",
                    "//     //     if (!VKM.app.globals.me)\r",
                    "// //     {\r",
                    "\r",
                    "//     var user=Ext.getStore('Users').getById(VKM.app.globals.authData.user_id);\r",
                    "//     user.set('photo_50',users.response.photo_src_small);\r",
                    "//     user.set('photo_200',users.response.photo_src);\r",
                    "//     user.set('photo_100',users.response.photo_src);\r",
                    "    var chatHeader=Ext.ComponentQuery.query('#chatHeader');\r",
                    "    if(chatHeader)\r",
                    "    {\r",
                    "       chatHeader[0].down('#avatar').setSrc(users.response.chat.photo_50);\r",
                    "    }\r",
                    "    Ext.ComponentQuery.query('#chatProfilePhoto')[0].setHtml('<img src=\"'+users.response.chat.photo_200+'\"\" ></img>')\r",
                    "\r",
                    "//     var controller=VKM.app.getController('InitDataLoader');\r",
                    "//     controller.loadUnreadMessagesStep1(false,true);\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "e3698ad4-a1ad-40b7-9320-fb319e0a8fab"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "request",
                    "users"
                ],
                "fn": "uploadFileStep2",
                "implHandler": [
                    "var formData = new FormData();\r",
                    "var dataController=VKM.app.getController('DataLoader');\r",
                    "formData.append(\"photo\", document.getElementById(\"photoToUpload1\").files[0]);\r",
                    "if(users.response&&users.response.upload_url)\r",
                    "{\r",
                    "    var client = new XMLHttpRequest();\r",
                    "    client.onreadystatechange = function ()\r",
                    "    {\r",
                    "        if (client.readyState == 4 && client.status == 200)\r",
                    "        {\r",
                    "            alert(client.response);\r",
                    "        }\r",
                    "    }\r",
                    "    //client.open(\"POST\",users.response.upload_url, true);\r",
                    "    var progressIndicator = Ext.create(\"Ext.ProgressIndicator\", {\r",
                    "        loadingText: \"Uploading: {percent}%\"\r",
                    "    });\r",
                    "\r",
                    "    //            client.send(formData);\r",
                    "    //            /* Send to server */\r",
                    "    Ext.Ajax.request({\r",
                    "        url:users.response.upload_url,\r",
                    "        method: 'POST',\r",
                    "        enctype:'multipart/form-data',\r",
                    "        data:formData,\r",
                    "        progress: progressIndicator,\r",
                    "        //isUpload:true,\r",
                    "        // binaryData:formData,\r",
                    "        xhr2:true,\r",
                    "        callback:function(request,success,response)\r",
                    "        {\r",
                    "            if(success)\r",
                    "            {\r",
                    "                var controller=VKM.app.getController('Dialogues');\r",
                    "                var dataController=VKM.app.getController('DataLoader');\r",
                    "                var data=JSON.parse(response.responseText);\r",
                    "                controller.uploadOverlay.destroy();\r",
                    "                \r",
                    "                \r",
                    "                var url='https://api.vk.com/method/photos.saveMessagesPhoto'; //photos.saveProfilePhoto';\r",
                    "                var params=\r",
                    "                    {\r",
                    "                        v:'5.4',\r",
                    "                        access_token:VKM.app.globals.authData['access_token'],\r",
                    "                        server:data.server,\r",
                    "                        photo:data.photo,\r",
                    "                        hash:data.hash\r",
                    "                    };\r",
                    "                dataController.go(url,params,dataController.uploadFileStep3);\r",
                    "            }\r",
                    "            else\r",
                    "            {\r",
                    "                alert(response.responseText)\r",
                    "            }\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "    })\r",
                    "\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "841418e2-d858-4609-9fbd-00cf6e01cc41"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "request",
                    "users"
                ],
                "fn": "uploadDocStep2",
                "implHandler": [
                    "var formData = new FormData();\r",
                    "var dataController=VKM.app.getController('DataLoader');\r",
                    "console.log(document.getElementById(\"docToUpload1\").files[0]);\r",
                    "formData.append(\"file\", document.getElementById(\"docToUpload1\").files[0]);\r",
                    "if(users.response&&users.response.upload_url)\r",
                    "{\r",
                    "    var client = new XMLHttpRequest();\r",
                    "    client.onreadystatechange = function ()\r",
                    "    {\r",
                    "        if (client.readyState == 4 && client.status == 200)\r",
                    "        {\r",
                    "            alert(client.response);\r",
                    "        }\r",
                    "    }\r",
                    "    //client.open(\"POST\",users.response.upload_url, true);\r",
                    "    var progressIndicator = Ext.create(\"Ext.ProgressIndicator\", {\r",
                    "        loadingText: \"Uploading: {percent}%\"\r",
                    "    });\r",
                    "\r",
                    "    //            client.send(formData);\r",
                    "    //            /* Send to server */\r",
                    "    Ext.Ajax.request({\r",
                    "        url:users.response.upload_url,\r",
                    "        method: 'POST',\r",
                    "        enctype:'multipart/form-data',\r",
                    "        data:formData,\r",
                    "        progress: progressIndicator,\r",
                    "        //isUpload:true,\r",
                    "        // binaryData:formData,\r",
                    "        xhr2:true,\r",
                    "        callback:function(request,success,response)\r",
                    "        {\r",
                    "            if(success)\r",
                    "            {\r",
                    "                var controller=VKM.app.getController('Dialogues');\r",
                    "                var dataController=VKM.app.getController('DataLoader');\r",
                    "                var data=JSON.parse(response.responseText);\r",
                    "                controller.uploadOverlay.destroy();\r",
                    "                \r",
                    "                \r",
                    "                var url='https://api.vk.com/method/docs.save'; //photos.saveProfilePhoto';\r",
                    "                var params=\r",
                    "                    {\r",
                    "                        v:'5.4',\r",
                    "                        access_token:VKM.app.globals.authData['access_token'],\r",
                    "                        file:data.file\r",
                    "                        \r",
                    "                    };\r",
                    "                dataController.go(url,params,dataController.uploadDocStep3);\r",
                    "            }\r",
                    "            else\r",
                    "            {\r",
                    "                alert(response.responseText)\r",
                    "            }\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "    })\r",
                    "\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "7d6f9d5f-33fd-4403-9cfb-69f2ee9c6df1"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadDocStep3",
                "implHandler": [
                    "console.log(users.response);\r",
                    "if(users.response[0]&&users.response[0].id)\r",
                    "{\r",
                    "    Ext.getStore('Docs').add(users.response[0]);\r",
                    "    var icon=\"resources/images/ext/128/\"+users.response[0].ext.toUpperCase()+'.jpg';\r",
                    "    if (!VKM.app.globals.docIcons[users.response[0].ext.toUpperCase()])\r",
                    "    {\r",
                    "        icon=\"resources/images/ext/128/Default.jpg\";\r",
                    "    }\r",
                    "    var attachmentStore=Ext.getStore('Attachments');\r",
                    "    var attachment={\r",
                    "        type:'doc',\r",
                    "        name:users.response[0].title+'('+users.response[0].size+')',\r",
                    "        id:'doc'+users.response[0].owner_id+'_'+users.response[0].id,\r",
                    "        icon:icon\r",
                    "    };\r",
                    "    attachmentStore.add(attachment);\r",
                    "    console.log(attachment);\r",
                    "}"
                ]
            },
            "designerId": "64cdc442-a668-4b62-99a4-05a4abea00c2"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadFileStep3",
                "implHandler": [
                    "if(users.response[0]&&users.response[0].id)\r",
                    "{\r",
                    "\r",
                    "    var attachmentStore=Ext.getStore('Attachments');\r",
                    "    var attachment={\r",
                    "        picture:users.response[0].photo_130,\r",
                    "        name:'',\r",
                    "        id:'photo'+users.response[0].owner_id+'_'+users.response[0].id\r",
                    "    };\r",
                    "    attachmentStore.add(attachment);\r",
                    "    console.log(attachmentStore);\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "a6ded4b8-5380-49e7-a4eb-9e28cdb27f18"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "request",
                    "users"
                ],
                "fn": "uploadAuidoStep2",
                "implHandler": [
                    "var formData = new FormData();\r",
                    "var dataController=VKM.app.getController('DataLoader');\r",
                    "formData.append(\"file\", document.getElementById(\"audioToUpload1\").files[0]);\r",
                    "if(users.response&&users.response.upload_url)\r",
                    "{\r",
                    "    var client = new XMLHttpRequest();\r",
                    "    client.onreadystatechange = function ()\r",
                    "    {\r",
                    "        if (client.readyState == 4 && client.status == 200)\r",
                    "        {\r",
                    "            alert(client.response);\r",
                    "        }\r",
                    "    }\r",
                    "    //client.open(\"POST\",users.response.upload_url, true);\r",
                    "    var progressIndicator = Ext.create(\"Ext.ProgressIndicator\", {\r",
                    "        loadingText: \"Uploading: {percent}%\"\r",
                    "    });\r",
                    "\r",
                    "    //            client.send(formData);\r",
                    "    //            /* Send to server */\r",
                    "    Ext.Ajax.request({\r",
                    "        url:users.response.upload_url,\r",
                    "        method: 'POST',\r",
                    "        enctype:'multipart/form-data',\r",
                    "        data:formData,\r",
                    "        progress: progressIndicator,\r",
                    "        //isUpload:true,\r",
                    "        // binaryData:formData,\r",
                    "        xhr2:true,\r",
                    "        callback:function(request,success,response)\r",
                    "        {\r",
                    "\r",
                    "            console.log(arguments);\r",
                    "            if(success)\r",
                    "            {\r",
                    "                var controller=VKM.app.getController('Dialogues');\r",
                    "                var dataController=VKM.app.getController('DataLoader');\r",
                    "                var data=JSON.parse(response.responseText);\r",
                    "                controller.uploadOverlay.destroy();\r",
                    "                \r",
                    "                \r",
                    "                var url='https://api.vk.com/method/audio.save'; //photos.saveProfilePhoto';\r",
                    "                var params=\r",
                    "                    {\r",
                    "                        v:'5.4',\r",
                    "                        access_token:VKM.app.globals.authData['access_token'],\r",
                    "                        server:data.server,\r",
                    "                        audio:data.audio,\r",
                    "                        hash:data.hash\r",
                    "                    };\r",
                    "                dataController.go(url,params,dataController.uploadAudioStep3);\r",
                    "            }\r",
                    "            else\r",
                    "            {\r",
                    "                alert(response.responseText)\r",
                    "            }\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "    })\r",
                    "\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "7711ec55-e260-4cd4-807f-2ae21c40d85d"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response",
                    "users"
                ],
                "fn": "uploadAudioStep3",
                "implHandler": [
                    "if(users.response.id)\r",
                    "{\r",
                    "    \r",
                    "    var attachment={\r",
                    "        title:users.response.title,\r",
                    "        artist:users.response.artist,\r",
                    "        id:users.response.id,\r",
                    "        owner_id:users.response.owner_id,\r",
                    "        duration:users.response.duration,\r",
                    "        url:users.response.url\r",
                    "    };\r",
                    "    Ext.getStore('Audios').add(attachment);\r",
                    "\r",
                    "    \r",
                    "    var attachmentStore=Ext.getStore('Attachments');\r",
                    "    var attachment={   \r",
                    "        type:'audio',\r",
                    "        name:users.response.artist+', '+users.response.title,\r",
                    "        id:'audio'+users.response.owner_id+'_'+users.response.id\r",
                    "    };\r",
                    "    attachmentStore.add(attachment);\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "4a583353-1054-4a30-8229-87393505c21e"
        }
    ]
}